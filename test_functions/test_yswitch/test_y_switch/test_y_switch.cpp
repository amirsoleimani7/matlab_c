#include "H_header.h"

using namespace std;
using namespace Eigen;

int main(){
    
    MatrixXd line(14, 10); // 14 rows and 10 columns

    line << 1, 5, 0, 0.0167, 0, 1, 0, 0, 0, 0,
            2, 10, 0, 0.0167, 0, 1, 0, 0, 0, 0,
            3, 4, 0, 0.005, 0, 1, 0, 1.2, 0.8, 0.02,
            3, 10, 0.001, 0.01, 0.0175, 1, 0, 0, 0, 0,
            3, 11, 0.011, 0.11, 0.1925, 1, 0, 0, 0, 0,
            3, 11, 0.011, 0.11, 0.1925, 1, 0, 0, 0, 0,
            5, 10, 0.0025, 0.025, 0.0437, 1, 0, 0, 0, 0,
            6, 12, 0, 0.0167, 0, 1, 0, 0, 0, 0,
            7, 13, 0, 0.0167, 0, 1, 0, 0, 0, 0,
            8, 11, 0.011, 0.11, 0.1925, 1, 0, 0, 0, 0,
            8, 11, 0.011, 0.11, 0.1925, 1, 0, 0, 0, 0,
            8, 9, 0, 0.005, 0, 1, 0, 1.2, 0.8, 0.02,
            8, 13, 0.001, 0.01, 0.0175, 1, 0, 0, 0, 0,
            12, 13, 0.0025, 0.025, 0.0437, 1, 0, 0, 0, 0;
    
    cout << "line is \n" << line << "\n";
    
    MatrixXd bus(13, 15); // 13 rows and 15 columns

    bus << 1, 1.03, 18.5, 7, 1.61, 0, 0, 0, 0, 1, 5, -1, 22, 1.1, 0.9,
           2, 1.01, 8.8, 7, 1.76, 0, 0, 0, 0, 2, 5, -1, 22, 1.1, 0.9,
           3, 0.9781, -6.1, 0, 0, 0, 0, 0, 3, 3, 0, 0, 230, 1.5, 0.5,
           4, 0.95, -10, 0, 0, 9.76, 1, 0, 0, 3, 0, 0, 115, 1.05, 0.95,
           5, 1.0103, 12.1, 0, 0, 0, 0, 0, 0, 3, 0, 0, 230, 1.5, 0.5,
           6, 1.03, -6.8, 7.16, 1.49, 0, 0, 0, 0, 2, 5, -1, 22, 1.1, 0.9,
           7, 1.01, -16.9, 7, 1.39, 0, 0, 0, 0, 2, 5, -1, 22, 1.1, 0.9,
           8, 0.9899, -31.8, 0, 0, 0, 0, 0, 5, 3, 0, 0, 230, 1.5, 0.5,
           9, 0.95, -35, 0, 0, 17.65, 1, 0, 0, 3, 0, 0, 115, 1.05, 0.95,
           10, 0.9876, 2.1, 0, 0, 0, 0, 0, 0, 3, 0, 0, 230, 1.5, 0.5,
           11, 1, -19.3, 0, 1.09, 0, 0, 0, 0, 2, 2, 0, 500, 1.5, 0.5,
           12, 1.0125, -13.4, 0, 0, 0, 0, 0, 0, 3, 0, 0, 230, 1.5, 0.5,
           13, 0.9938, -23.6, 0, 0, 0, 0, 0, 0, 3, 0, 0, 230, 1.5, 0.5;

    cout << "bus is \n" << bus << "\n";

    MatrixXd load_con(2, 5); // 2 rows and 5 columns

    load_con << 4, 0, 0, 0.5, 0,
                9, 0, 0, 0.5, 0;

    cout << "load_con is \n" << load_con << "\n";

    MatrixXd mac_con(4, 19); // 4 rows and 19 columns

    mac_con << 1, 1, 900, 0.2, 0, 0, 0.25, 0, 0, 0, 0, 0, 0, 0, 0, 6.5, 0, 0, 1,
               2, 2, 900, 0.2, 0, 0, 0.25, 0, 0, 0, 0, 0, 0, 0, 0, 6.5, 0, 0, 2,
               3, 6, 900, 0.2, 0, 0, 0.25, 0, 0, 0, 0, 0, 0, 0, 0, 6.5, 0, 0, 6,
               4, 7, 900, 0.2, 0, 0, 0.25, 0, 0, 0, 0, 0, 0, 0, 0, 6.5, 0, 0, 7;

    cout << "mac_con is \n" << mac_con << "\n";

    MatrixXd sw_con(5, 7); // 5 rows and 7 columns

    sw_con << 0,    0,  0, 0, 0, 0, 0.005,
              0.2,  3, 11, 0, 0, 7, 0.005,
              0.31, 0,  0, 0, 0, 0, 0.005,
              0.41, 0,  0, 0, 0, 0, 0.01,
              5,    0,  0, 0, 0, 0, 0;

    cout << "sw_con is \n" << sw_con << "\n";

    /* void y_switch(MatrixXd& bus, MatrixXd& line,MatrixXd& load_con, MatrixXd& mac_con, MatrixXd& sw_con) */
    MatrixXd bus_sol ,line_sol, line_flow;
    double acc = 1.0;
    double iter_max = 30;
    double tol = 1.0e-8;
    double basmva = 100;
    string display  = "n";
    double flag = 1;

    load_flow(bus,line,tol,iter_max,acc,display,flag,bus_sol,line_sol,line_flow);

    y_switch(bus_sol,line_sol,load_con,mac_con,sw_con);

    return 0;
}